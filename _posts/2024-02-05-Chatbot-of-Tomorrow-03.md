# The Chatbot Architecture of Tomorrow – (3) What Are the Solutions?

<img src="/docs/assets/img/FOT/Blind elephant 02.jpeg" target = "_blank" rel = "noreferrer noopener" alt = "" width="400"/>

*"I'm thinking serpentine robot; we go all in on hypermobility." AI prognostication is like a modern day parable of blind men cybernetically enhancing an elephant. (Image created with DALL·E 3)*

This is where it’s all been headed!  For each issue highlighted in the [last post](https://landrewwray.github.io/2024/02/01/Chatbot-of-Tomorrow-02.html), I’ll touch on “**standard**” solutions that are already in widespread use, feasible-but-risky “**adventurous**” approaches, and “**radical**” approaches that would be much more drastic to implement.

## 1\. Each token (word part) gets the same amount of ‘thought’.  

**Standard**: A popular tactic is to ask the model to express its reasoning in writing.  This technique is termed chain of thought (CoT), and there’s a wide body of literature around it.  Chatbots aren’t intrinsically great at this kind of task, and smaller models do particularly poorly, but performance can be <a href = "https://arxiv.org/abs/2305.14045" target = "_blank" rel = "noreferrer noopener">improved via fine tuning</a>.  

**Adventurous**: A number of innovative approaches can be found in the literature addressing a broader class of CoT-like solutions, collectively termed “<a href = "https://arxiv.org/abs/2308.09687" target = "_blank" rel = "noreferrer noopener">graph of thought</a>” (GoT).  As the name evokes, these approaches can allow models to create and traverse mind map bubble diagrams.

**Radical**: A key difference between artificial and biological neural networks is that biological neural networks do not shy away from <a href = "https://www.biorxiv.org/content/10.1101/2023.07.29.551086v1.full.pdf" target = "_blank" rel = "noreferrer noopener">cyclical neuronal connectivity</a> and reciprocal connections between ‘modules’ of the brain.  One would have to think very carefully before incorporating something of this sort within a transformer stack, but a minimal approach might be to add optionally <a href = "https://arxiv.org/abs/2111.05297" target = "_blank" rel = "noreferrer noopener">recursive layers</a> or blocks.  As a specific example, one could pass the hidden states output by a selected transformer (say, layer 16) to a perceptron layer with a single yes/no output to determine if the states should be passed forward to the next transformer (layer 17) or backwards for a repeated run of the last few layers (layers 14-16).

## 2\. Tokens are overloaded as RAM.  

**Standard**:  Chatbots have a range of emergent tricks for making the most out of the state vectors they’re allocated, such as loading <a href = "https://landrewwray.github.io/2023/10/26/Managing-attention.html" target = "_blank" rel = "noreferrer noopener">frequently referenced constants</a> and (it appears) <a href = "https://arxiv.org/abs/2310.02207" target = "_blank" rel = "noreferrer noopener">sentence summaries</a> into the hidden state vectors of punctuation tokens, such as periods.  The <a href = "https://arxiv.org/abs/2309.03409" target = "_blank" rel = "noreferrer noopener">distinctive ML-identified prompts that optimize CoT performance</a> for specific models probably interact constructively with this form of memory management.

**Adventurous**:  One could potentially try to mitigate these memory and 'thinking time' bottlenecks by adding a new class of padding token that I’ll term a ‘thinking token’ to the model’s vocabulary. Thinking tokens would exist purely to allow the model to allocate an additional set of state vectors, and would not be considered in perplexity calculations so long as the chatbot used them infrequently (say, <10% frequency):

<img src="/docs/assets/img/FOT/thinking_token.png" target = "_blank" rel = "noreferrer noopener" alt = "" width="600"/>

**Architecture schematic with a ‘thinking token’**.  *Words proposed by the model are shown at the top of panel (B).  As the model is reading a user-provided prompt, only the [think] token is entered into the input text stream, where it results in the creation of an extra set of state vectors.*

This would go a (very) small step towards making models function as a persistent awareness – akin to human consciousness.

**Radical**:  It would be easy to add extra sets of <a href = "https://en.wikipedia.org/wiki/Long_short-term_memory" target = "_blank" rel = "noreferrer noopener">LSTM-like</a> memory states that are passed forward along the token axis and communicate with selected transformer layers within the chatbot model.  <a href = "https://arxiv.org/abs/2203.07852" target = "_blank" rel = "noreferrer noopener">Plausible designs</a> in this broader class have been explored, so there are probably good reasons that we’re not seeing them incorporated in the latest open models.

## 3\. Models have no long-term memory.  

**Standard**: The default answer to this is to apply some form of <a href = "https://arxiv.org/abs/2005.11401v4" target = "_blank" rel = "noreferrer noopener">retrieval augmented generation (RAG)</a>, which amounts to giving the model access to a search engine.  One can also train the model on content that you want it to ‘memorize’, but this opens up several cans of worms, and tends to be a better fit for skill and alignment training than knowledge acquisition.  It’s common to <a href = "https://arxiv.org/abs/2212.07677" target = "_blank" rel = "noreferrer noopener">liken RAG to single-step fine tuning</a> within the literature, but the two are not the same. For example, in context learning does not suffer from the <a href = "https://arxiv.org/abs/2309.12288" target = "_blank" rel = "noreferrer noopener">reversal curse</a>, in which a chatbot that has been exposed to an A-->B relationship during training (say, "Hexaquarks are six-quark particles") is able to answer "What is A?" ("What is a hexaquark?") but will often fail to answer questions about the reverse relationship ("What would you call a six-quark particle?").

**Adventurous**: There are a lot of fascinating ideas floating around right now!  Using an auxiliary AI model to organize archived information in a knowledge graph (<a href = "https://github.com/zjukg/KG-LLM-Papers" target = "_blank" rel = "noreferrer noopener">KG-RAG</a>) can enable superior associative memory, though at a cost in complexity (computational and otherwise).  Alternatively, one can take things in the opposite direction and use the base chatbot model for everything.  This is the <a href = "https://github.com/abertsch72/unlimiformer" target = "_blank" rel = "noreferrer noopener">unliformer</a>/<a href = "https://arxiv.org/abs/2401.06104" target = "_blank" rel = "noreferrer noopener">multistate RNN</a> approach, which uses the base chatbot model to encode archived information as hidden state vectors, and then co-opts the key/query attention mechanism as a search engine to identify relevant content outside of a conventional context window.

**Radical**: It would be exciting to have a model that could form long term memories within its own ‘brain’ (the model parameters), rather than needing to log them in an external database and pull them up with a search engine.  If we look to biological brains for inspiration, a couple of elements that stand out are: (1) the ability to convert <a href = "https://www.nature.com/articles/s41593-023-01514-1#Abs1" target = "_blank" rel = "noreferrer noopener">neural activity into memory</a> without full backpropagation; and (2) integration of context and the experiential process of learning within memory.  The chatbot should be able to recall the <a href = "https://www.cell.com/trends/cognitive-sciences/fulltext/S1364-6613(22)00265-0" target = "_blank" rel = "noreferrer noopener">context in which learning occurred</a> and have some impression of its own concurrent thoughts.

Another way to frame this is that we want to convert the short term memory that language models exhibit during conversations, termed “in context learning”, into an update to parameter weights.  This looks promising at first glance.  Several recent papers have established a strong similarity between in context learning and gradient descent parameter optimization.  One can define a matrix that represents in context learning for a given attention head (for example, <a href = "https://arxiv.org/abs/2212.10559" target = "_blank" rel = "noreferrer noopener">“&Delta;W<sub>ICL</sub>” in this paper</a>) and use it as a learning target, but the devil is always in the details for a real engineering challenge like this.

For example: &Delta;W<sub>ICL</sub> is relatively low-dimensional, and leaves the parameter update underspecified; the update may be difficult to harmonize with positional encoding; we no longer have explicit coupling to an output based loss function such as perplexity or RLHF; and parameter updates may lead to instability or <a href = "https://en.wikipedia.org/wiki/Catastrophic_interference" target = "_blank" rel = "noreferrer noopener">catastrophic forgetting</a>, which is something that even humans undergo in the form of <a href = "https://www.ncbi.nlm.nih.gov/pmc/articles/PMC5473198/" target = "_blank" rel = "noreferrer noopener">childhood amnesia</a>.

Having a fluid exchange between long and short term memory also frees the brain from needing to constantly reference thousands of words within a ‘context window’ of immediate working memory.  In fact, human immediate memory has a persistence of <a href = "https://www.ncbi.nlm.nih.gov/pmc/articles/PMC2649674/" target = "_blank" rel = "noreferrer noopener">less than 1 minute</a>, beyond which information needs to be maintained through longer term storage or active rehearsal.  This naively corresponds to context window of just ~100 words, if you factor in the typical speed of speech.

A model with this capability would have a different relationship with its training data.  In context learning involves kinds of <a href = "https://arxiv.org/abs/2310.02207" target = "_blank" rel = "noreferrer noopener">free association</a> that standard model training does not – for example, it does not suffer from the <a href = "https://arxiv.org/abs/2309.12288" target = "_blank" rel = "noreferrer noopener">reversal curse</a>.  An optimistic take is that such a model might require far less training data, akin to human learning which tends to require relatively few examples.  We can thank <a href = "https://www.smbc-comics.com/" target = "_blank" rel = "noreferrer noopener">SMBC</a> for a less optimistic interpretation of this particular gedanken experiment:

<img src="/docs/assets/img/FOT/Premature consciousness.png" target = "_blank" rel = "noreferrer noopener" alt = "" width="500"/>

## 4\. Attention layers are pattern matching tools: 

**Standard**:  The obvious band-aid is fine tuning.  All current chatbots receive specialized training on data sets that promote cognitive skills such as attention span (see <a href = "https://arxiv.org/abs/2307.09288" target = "_blank" rel = "noreferrer noopener">Llama 2 ‘ghost attention’</a>) and <a href = "https://arxiv.org/abs/2305.14045" target = "_blank" rel = "noreferrer noopener">domain-specific chain of thought</a> reasoning.  However, the degree to which this ‘reasoning’ proficiency transfers between domains can be limited.

At an architectural level, if the attention sublayer is a poor basis for ‘cognition’, it would make sense to focus instead on the general purpose feedforward sublayer that constitutes the other half of a transformer.  This is exactly what has happened.  The Llama family of open source chatbot models added a 3rd matrix (<a href = "https://paperswithcode.com/method/glu" target = "_blank" rel = "noreferrer noopener">GLU activation</a>) to the feedforward layer, and the <a href = "https://huggingface.co/spaces/lmsys/chatbot-arena-leaderboard" target = "_blank" rel = "noreferrer noopener">strongest open model</a> at the time of writing, Mixtral-8x7b, expands the feedforward parameter count by a further factor of 8.  Feedforward networks are well suited to applying logic gates and mapping out conditional relationships.  The feedforward networks of consecutive layers can (in principle) work together to deliver the versatility of a deep multilayer perceptron network.

**Adventurous**: Multi-agent systems (MAS) are a hot topic in AI and have the potential to become much hotter.  These systems often assign several chatbot agents to function as <a href = "https://arxiv.org/abs/2305.14325" target = "_blank" rel = "noreferrer noopener">competing debaters</a>, and can do well relative to naïve zero-shot chain of thought prompting.  A long term question is whether the agent roles can ultimately be expanded to function as an entirely different collective entity.  As limitations on reasoning and long-term memory are pushed back, one can imagine the formation of companies in which all or most employee roles are taken on by AI.  One can also imagine that this would be a sufficient and perhaps necessary condition for the Robot Apocalypse – Chatbot Edition.

**Radical**: If feedforward sublayers provide a part of the solution, then there are endless ways to expand them, expand their connectivity within the transformer stack, or to couple in auxiliary neural networks – akin to the reciprocal synaptic connections between different areas in the human brain.  Of course, most approaches of this sort would violate the architectural principle of simplicity that has dominated transformer-based AI development.

## 5\. Chatbots are required to overthink things.  

**Standard**: Once again, training is the main way to address this issue, including reinforcement learning with human feedback (RLHF).  Ensuring that questions in the training data are <a href = "https://arxiv.org/abs/2306.11644" target = "_blank" rel = "noreferrer noopener">answered correctly</a> and use well-constructed chains of thought (CoT) also helps keep the model focused on the right things.  Nonetheless, it’s <a href = "https://arxiv.org/abs/2307.15217" target = "_blank" rel = "noreferrer noopener">very challenging to align chatbots with human goals</a>.

**Adventurous**: One can train models to navigate mind maps (graph of thought, GoT), as noted in item #1 above.  Framing a problem in terms of a mind map can force a chatbot to focus more closely on one line of reasoning at a time.

**Radical**: If you want a chatbot can think in an organized way, the best human-inspired approach may be to have it remember and consciously develop its own creative process, as considered in the "radical" section of item #3 above.

## 6\.	Chatbots are energy-inefficient problem solvers.

**Standard**: There’s a lot of room to <a href = "https://en.wikipedia.org/wiki/Knowledge_distillation" target = "_blank" rel = "noreferrer noopener">distill</a> (or otherwise engineer) capabilities of larger models into much smaller models, such as for translation, <a href = "https://aws.amazon.com/solutions/implementations/qnabot-on-aws/" target = "_blank" rel = "noreferrer noopener">simple conversation</a>, or navigating app interfaces.  The <a href = "https://www.theverge.com/2024/1/9/24030667/rabbit-r1-ai-action-model-price-release-date" target = "_blank" rel = "noreferrer noopener">Rabbit R1</a> seems to lead the pack in this regard, and squeezes a wide range of multimodal AI capabilities into a $200 package with far too little computing power to run a top-of-the-line language model.

**Adventurous**: If emulating chatbots on digital computing devices is too expensive, how about creating ***analog*** computers that can run your AI natively?!  As it happens, there’s an entire field of engineering devoted to the exploration of these ‘<a href = "https://en.wikipedia.org/wiki/Neuromorphic_engineering" target = "_blank" rel = "noreferrer noopener">neuromorphic</a>’ analog computing technologies, and I’ve seen a number of fascinating approaches to the problem over the years.  The stakes motivating this class of innovation are higher than ever, and companies like <a href = "https://lightmatter.co/" target = "_blank" rel = "noreferrer noopener">Lightmatter</a> will be fascinating to follow over the coming decade.

**Radical**: Sam Altman and others have recently drawn attention <a href = "https://www.cnbc.com/2023/05/10/microsoft-agrees-to-buy-power-from-sam-altman-backed-helion-in-2028.html" target = "_blank" rel = "noreferrer noopener">towards fusion power</a> as a potential mitigating factor.  Exciting breakthroughs over the last decade seem poised to allow stable fusion power generation to be achieved <a href = "https://en.wikipedia.org/wiki/SPARC_(tokamak)" target = "_blank" rel = "noreferrer noopener">in the next few years</a>.  The world could really use a new clean and abundant power source, but it will probably take a while to see where the current technological push can really get us as far as the stability, maintenance costs, and overall practicality of fusion power facilities.  For example, quenches (sudden failures) of the superconducting magnet that contains a fusion reaction can release energy comparable to 1000 kg of TNT and may be difficult to avoid due to <a href = "https://arxiv.org/abs/2308.03794" target = "_blank" rel = "noreferrer noopener">progressive radiation damage</a>.

## 7\. Chatbots will face regulatory scrutiny. (policy architecture!)

This series of posts is focused on the technical side of things, so I won't try to do justice to AI policy.  (Maybe some other time?  I'd love to exchange thoughts in person!)  We’re already seeing the shadow of AI in <a href = "https://www.wbaltv.com/article/musicians-union-prepared-strike-ai-protections-streaming-residuals/46471224" target = "_blank" rel = "noreferrer noopener">union contract negotiations</a> and <a href = "https://www.europarl.europa.eu/news/en/headlines/society/20230601STO93804/eu-ai-act-first-regulation-on-artificial-intelligence" target = "_blank" rel = "noreferrer noopener">laws that regulate the use and capabilities of AI</a>.  I’m sure this is just the beginning, and I’m just as sure that, to some extent, the genie is out of the bottle.
